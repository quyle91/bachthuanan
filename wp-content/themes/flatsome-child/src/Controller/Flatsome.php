<?php
namespace Project\Controller;

class Flatsome {
	private static $instance = null;
	public static function get_instance() {
		if ( is_null( self::$instance ) ) {
			self::$instance = new self();
		}
		return self::$instance;
	}

	function __construct() {
		add_action( 'after_switch_theme', function () {
			update_option( 'flatsome_wup_buyer', 'thaiduong103' );
			update_option( 'flatsome_wup_purchase_code', 'c173b5f9-c7a7-4f30-83be-90e22de44f0d' );
			update_option( 'flatsome_wup_sold_at', '2017-02-20T20:26:11+11:00' );
			update_option( 'flatsome_wup_supported_until', '2017-08-22T11:26:11+10:00' );
		} );

		$this->custom_quick_view();
		$this->page_header();
	}

	function custom_quick_view(){
		add_action('init', function(){
			remove_action( 'flatsome_product_box_actions', 'flatsome_lightbox_button', 50 );
			add_action( 'flatsome_product_box_actions', [$this, 'flatsome_lightbox_button'], 50 );
		});
	}

	function flatsome_lightbox_button() {
		if ( get_theme_mod( 'disable_quick_view', 0 ) ) {
			return;
		}

		// Run Quick View Script.
		wp_enqueue_script( 'wc-add-to-cart-variation' );

		global $product;
		?>
		<style type="text/css">
			/* .grid-tools{
				opacity: 1 !important;
				transform: unset !important;
			} */
		</style>
		<a 
			class="bta_a_wrap bta_wish" 
			>
				<svg width="21" height="18" viewBox="0 0 21 18" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M18.5187 2.0038C17.5037 0.867554 16.0962 0.242554 14.5537 0.242554C12.3812 0.242554 11.0112 1.51505 10.2437 2.5813C10.1625 2.6938 10.0837 2.8113 10.0062 2.93255C9.92997 2.8113 9.84997 2.6938 9.76997 2.5813C9.00247 1.51505 7.63247 0.242554 5.45872 0.242554C3.91622 0.242554 2.50872 0.867554 1.49372 2.0038C0.531221 3.08005 0.0012207 4.5188 0.0012207 6.05505C0.0012207 7.72255 0.654971 9.26505 2.05747 10.9088C3.28122 12.3438 5.02622 13.8113 7.05747 15.5176L7.13247 15.5788C7.85747 16.1901 8.60997 16.8213 9.43372 17.5313C9.59122 17.6688 9.79497 17.7438 10.0062 17.7438C10.2187 17.7438 10.4225 17.6688 10.605 17.5101C11.3787 16.8413 12.11 16.2276 12.8162 15.6326L12.9562 15.5163C14.9812 13.8151 16.7312 12.3451 17.955 10.9088C19.3575 9.26505 20.0112 7.72255 20.0112 6.05505C20.0112 4.5188 19.4825 3.08005 18.5187 2.0038ZM11.615 14.3813C11.095 14.8176 10.5625 15.2663 10.0062 15.7413C9.45122 15.2663 8.91747 14.8176 8.39747 14.3813L8.18497 14.2013C4.30622 10.9438 1.74497 8.7913 1.74497 6.05505C1.74497 4.9388 2.11872 3.9063 2.79997 3.14505C3.47997 2.38505 4.42372 1.9663 5.45872 1.9663C6.88872 1.9663 7.81997 2.8438 8.34997 3.5813C8.83622 4.26005 9.09122 4.94255 9.17872 5.20505C9.29497 5.56005 9.62747 5.80005 10.0062 5.80005C10.385 5.80005 10.7175 5.56005 10.8337 5.20505C10.9225 4.94255 11.1762 4.26005 11.6637 3.5813C12.1925 2.8438 13.125 1.9663 14.5537 1.9663C15.5887 1.9663 16.5325 2.38505 17.2125 3.1463C17.8937 3.9063 18.2675 4.9388 18.2675 6.05505C18.2675 8.7913 15.7062 10.9438 11.8275 14.2013L11.615 14.3813Z" fill="white"/> </svg>

		</a>
		<a 
			class="bta_a_wrap bta_add_to_cart" 
			>
				<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M20 6.71901V9.84401C20 10.276 19.65 10.626 19.219 10.626H18.705L18.376 13.555C18.331 13.954 17.993 14.249 17.6 14.249C17.571 14.249 17.542 14.247 17.512 14.244C17.083 14.195 16.775 13.809 16.823 13.38L17.23 9.75701C17.274 9.36201 17.609 9.06301 18.006 9.06301H18.438V7.50101H1.562V9.06301H14.883C15.314 9.06301 15.664 9.41301 15.664 9.84401C15.664 10.276 15.314 10.626 14.883 10.626H2.882L3.653 17.061C3.747 17.846 4.414 18.437 5.205 18.437H14.858C15.654 18.437 16.322 17.841 16.411 17.05C16.459 16.621 16.845 16.312 17.274 16.361C17.703 16.409 18.011 16.795 17.964 17.224C17.786 18.806 16.451 20 14.858 20H5.205C3.624 20 2.29 18.816 2.102 17.247L1.308 10.626H0.781C0.35 10.626 0 10.276 0 9.84401V6.71901C0 6.28801 0.35 5.93801 0.781 5.93801H3.552L7.68 0.320009C7.936 -0.0279909 8.425 -0.102991 8.773 0.153009C9.12 0.408009 9.195 0.897009 8.94 1.24501L5.491 5.93801H14.538L11.089 1.24501C10.834 0.897009 10.908 0.408009 11.256 0.153009C11.604 -0.102991 12.093 -0.0279909 12.348 0.320009L16.477 5.93801H19.219C19.65 5.93801 20 6.28801 20 6.71901ZM9.219 12.969V16.094C9.219 16.525 9.568 16.875 10 16.875C10.431 16.875 10.781 16.525 10.781 16.094V12.969C10.781 12.538 10.431 12.188 10 12.188C9.568 12.188 9.219 12.538 9.219 12.969ZM12.344 12.969V16.094C12.344 16.525 12.694 16.875 13.125 16.875C13.556 16.875 13.906 16.525 13.906 16.094V12.969C13.906 12.538 13.556 12.188 13.125 12.188C12.694 12.188 12.344 12.538 12.344 12.969ZM6.094 12.969V16.094C6.094 16.525 6.444 16.875 6.875 16.875C7.306 16.875 7.656 16.525 7.656 16.094V12.969C7.656 12.538 7.306 12.188 6.875 12.188C6.444 12.188 6.094 12.538 6.094 12.969Z" fill="white"/> </svg>

		</a>
		<a 
			class="bta_a_wrap quick-view" 
			data-prod="<?php echo $product->get_id(); ?>" 
			href="#quick-view">
				<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M2.42012 12.7132C2.28394 12.4975 2.21584 12.3897 2.17772 12.2234C2.14909 12.0985 2.14909 11.9015 2.17772 11.7766C2.21584 11.6103 2.28394 11.5025 2.42012 11.2868C3.54553 9.50484 6.8954 5 12.0004 5C17.1054 5 20.4553 9.50484 21.5807 11.2868C21.7169 11.5025 21.785 11.6103 21.8231 11.7766C21.8517 11.9015 21.8517 12.0985 21.8231 12.2234C21.785 12.3897 21.7169 12.4975 21.5807 12.7132C20.4553 14.4952 17.1054 19 12.0004 19C6.8954 19 3.54553 14.4952 2.42012 12.7132Z" stroke="white" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/> <path d="M12.0004 15C13.6573 15 15.0004 13.6569 15.0004 12C15.0004 10.3431 13.6573 9 12.0004 9C10.3435 9 9.0004 10.3431 9.0004 12C9.0004 13.6569 10.3435 15 12.0004 15Z" stroke="white" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
			</svg>
		</a>
		<?php 
	}

	function page_header(){

		add_action('flatsome_product_title', function(){
			if(is_front_page()){
				return;
			}
            if ( is_page() or is_home() or is_singular('post') ) {
                ob_start();
                ?>
                <div class="strong shop-page-title is-xlarge" style="margin-bottom: 0.5em;">
                    <?= get_the_title() ?>
                </div>
                <?php
                echo ob_get_clean();
            }
        });
		
		add_action( 'flatsome_after_header', function () {
			if(is_front_page()){
				return;
			}
			if ( is_page() or is_home() or is_singular('post') ) {
				wc_get_template_part( 'single-product/headers/header-product', 'featured-center' );
			}
		}, 10 );
	}
}